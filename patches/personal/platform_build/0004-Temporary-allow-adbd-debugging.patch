From 2fc6fc6461aa3e6c8d261dadd5a98fdd5e683ec4 Mon Sep 17 00:00:00 2001
From: "Christopher A. Williamson" <home@chrisaw.com>
Date: Sun, 5 May 2024 19:36:19 +0100
Subject: [PATCH] Temporary allow adbd debugging

---
 ...01-Enable-insecure-adb-for-debugging.patch | 28 ++++++++++++++++++
 core/main.mk                                  | 29 ++++---------------
 2 files changed, 33 insertions(+), 24 deletions(-)
 create mode 100644 core/0001-Enable-insecure-adb-for-debugging.patch

diff --git a/core/0001-Enable-insecure-adb-for-debugging.patch b/core/0001-Enable-insecure-adb-for-debugging.patch
new file mode 100644
index 0000000..2050c24
--- /dev/null
+++ b/core/0001-Enable-insecure-adb-for-debugging.patch
@@ -0,0 +1,28 @@
+From 5bf36e62fe43fe344191936a07417537ce11cb3d Mon Sep 17 00:00:00 2001
+From: "Christopher A. Williamson" <home@chrisaw.com>
+Date: Sun, 28 Apr 2024 22:01:09 +0100
+Subject: [PATCH] Enable insecure adb for debugging
+
+---
+ core/main.mk | 5 ++---
+ 1 file changed, 2 insertions(+), 3 deletions(-)
+
+diff --git a/core/main.mk b/core/main.mk
+index 090fe9a..e8ee273 100644
+--- a/core/main.mk
++++ b/core/main.mk
+@@ -394,9 +394,8 @@ ifneq (,$(user_variant))
+   # Target is secure in user builds.
+   ADDITIONAL_SYSTEM_PROPERTIES += ro.secure=1
+ 
+-  ifeq ($(user_variant),user)
+-    ADDITIONAL_SYSTEM_PROPERTIES += ro.adb.secure=1
+-  endif
++  # Enable unauthenticated adb for debugging.
++  ADDITIONAL_SYSTEM_PROPERTIES += ro.adb.secure=0
+ 
+   # Disable debugging in plain user builds.
+   enable_target_debugging :=
+-- 
+2.44.0
+
diff --git a/core/main.mk b/core/main.mk
index 090fe9a..ed94da8 100644
--- a/core/main.mk
+++ b/core/main.mk
@@ -390,31 +390,12 @@ user_variant :=
 endif
 enable_target_debugging := false
 tags_to_install :=
-ifneq (,$(user_variant))
-  # Target is secure in user builds.
-  ADDITIONAL_SYSTEM_PROPERTIES += ro.secure=1
 
-  ifeq ($(user_variant),user)
-    ADDITIONAL_SYSTEM_PROPERTIES += ro.adb.secure=1
-  endif
-
-  # Disable debugging in plain user builds.
-  enable_target_debugging :=
-
-  # Disallow mock locations by default for user builds
-  ADDITIONAL_SYSTEM_PROPERTIES += ro.allow.mock.location=0
-
-else # !user_variant
-  # Turn on checkjni for non-user builds.
-  ADDITIONAL_SYSTEM_PROPERTIES += ro.kernel.android.checkjni=0
-  # Set device insecure for non-user builds.
-  ADDITIONAL_SYSTEM_PROPERTIES += ro.secure=0
-  # Allow mock locations by default for non user builds
-  ADDITIONAL_SYSTEM_PROPERTIES += ro.allow.mock.location=1
-endif # !user_variant
-
-# Target is less debuggable and adbd is off by default
-ADDITIONAL_SYSTEM_PROPERTIES += ro.debuggable=0
+# Temporary patch to force enable adbd
+ADDITIONAL_SYSTEM_PROPERTIES += ro.secure=0
+ADDITIONAL_SYSTEM_PROPERTIES += ro.adb.secure=0
+ADDITIONAL_SYSTEM_PROPERTIES += ro.allow.mock.location=1
+ADDITIONAL_SYSTEM_PROPERTIES += ro.debuggable=1
 
 ## eng ##
 
-- 
2.44.0
