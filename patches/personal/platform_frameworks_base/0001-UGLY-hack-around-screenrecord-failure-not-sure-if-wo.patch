From f2bc3f6faeeff18957254913e131cc8dcfcd89ac Mon Sep 17 00:00:00 2001
From: kaii-lb <aosp@crave.io>
Date: Fri, 2 Aug 2024 15:32:22 +0000
Subject: [PATCH] UGLY hack around screenrecord failure, not sure if works

please don't do this, find an actual solution
---
 .../systemui/screenrecord/ScreenMediaRecorder.java   | 12 ++++++++++--
 1 file changed, 10 insertions(+), 2 deletions(-)

diff --git a/packages/SystemUI/src/com/android/systemui/screenrecord/ScreenMediaRecorder.java b/packages/SystemUI/src/com/android/systemui/screenrecord/ScreenMediaRecorder.java
index 61388923c5bd..219cea9743d7 100644
--- a/packages/SystemUI/src/com/android/systemui/screenrecord/ScreenMediaRecorder.java
+++ b/packages/SystemUI/src/com/android/systemui/screenrecord/ScreenMediaRecorder.java
@@ -291,12 +291,20 @@ public class ScreenMediaRecorder extends MediaProjection.Callback {
         }
 
         if (width >= screenWidthAligned && height >= screenHeightAligned
                 && vc.isSizeSupported(screenWidthAligned, screenHeightAligned)) {
             // Desired size is supported, now get the rate
-            int maxRate = vc.getSupportedFrameRatesFor(screenWidthAligned,
-                    screenHeightAligned).getUpper().intValue();
+            // Hack around refresh rate failure, try not to uhh, do this
+            int maxRate = 30;
+
+            try {
+            	maxRate = vc.getSupportedFrameRatesFor(screenWidthAligned,
+		           screenHeightAligned).getUpper().intValue();	
+            } catch (IllegalArgumentException e) {
+            	Log.e(TAG, "UGLY: Hacking around getSupportFrameRatesFor failure...fix me");
+            	maxRate = 30;
+            }
 
             if (maxRate < refreshRate) {
                 refreshRate = maxRate;
             }
             Log.d(TAG, "Screen size supported at rate " + refreshRate);
-- 
2.45.2
